const{BrowserWindow:BrowserWindow,app:app,ipcMain:ipcMain,nativeTheme:nativeTheme}=require("electron"),{Alert:Alert,Api:Api,Config:Config}=require("./components"),{LoadingScreen:LoadingScreen,MainScreen:MainScreen}=require("./screens"),path=require("path");let LOADING_ISDONE=!1;function setLoadingIsDone(e){LOADING_ISDONE=e,LOADING_ISDONE&&setTimeout((()=>{LoadingScreen.destroy(),MainScreen.show()}),2e3)}require("electron-squirrel-startup")&&app.quit(),app.on("ready",(()=>{LoadingScreen.show()})),app.whenReady().then((()=>{nativeTheme.themeSource="dark",console.log(`✅ [--app.whenReady--] - Config.DIZIPAL variable has been updated with Config.information, here are the new variable values; \n${JSON.stringify(Config.DIZIPAL)}`),Config.DIZIPAL.currentSiteURL?(console.log(`✅ [--app.whenReady--] - Current Site URL updated, current site url : ${Config.DIZIPAL.currentSiteURL}`),MainScreen.createWindow(Config.DIZIPAL.currentSiteURL)):MainScreen.createWindow(path.join(__dirname,"settings.html")),MainScreen.window.once("ready-to-show",(()=>{setLoadingIsDone(!0)})),app.on("activate",(()=>{0===BrowserWindow.getAllWindows().length&&MainScreen.createWindow(Config.DIZIPAL.currentSiteURL)}))})),app.on("window-all-closed",(()=>{"darwin"!==process.platform&&app.quit()})),ipcMain.handle("get-package-info",(()=>Config.getPackageInfo)),ipcMain.handle("get-package-version",(()=>app.getVersion)),ipcMain.handle("get-dizipal",(()=>Config.getInformation)),ipcMain.handle("get-api-url",(async()=>await Api.getCurrentSiteURL())),ipcMain.on("loading-is-done",((e,n)=>{setLoadingIsDone(n)})),ipcMain.on("set-dizipal",((e,n)=>{Config.setInformation(n)})),ipcMain.on("notification",((e,n)=>{Alert.show_notification(n)})),ipcMain.on("restart-app",(()=>{app.relaunch(),app.exit(0)}));