const{BrowserWindow:BrowserWindow,app:app,ipcMain:ipcMain,nativeTheme:nativeTheme}=require("electron"),{Alert:Alert,Api:Api,Config:Config}=require("./components"),{LoadingScreen:LoadingScreen,MainScreen:MainScreen}=require("./screens"),{Menus:Menus}=require("./menus"),path=require("path");let LOADING_ISDONE=!1;function setLoadingIsDone(e){if(LOADING_ISDONE=e,LOADING_ISDONE){const e=Config.getInformation.currentSiteURL;console.log(`✓ app.whenReady —▶ Config.DIZIPAL variable has been updated with Config.information, here are the new variable values; \n${JSON.stringify(Config.DIZIPAL)}`),e?(console.log(`✓ app.whenReady —▶ Current Site URL updated, current site url : ${e}`),MainScreen.createWindow(e)):MainScreen.createWindow(path.join(__dirname,"settings.html")),app.on("activate",(()=>{0===BrowserWindow.getAllWindows().length&&MainScreen.createWindow(e)})),app.whenReady().then((()=>{MainScreen.window.on("ready-to-show",(()=>{LoadingScreen.destroy(),MainScreen.show()}))}))}}app.on("ready",(()=>{nativeTheme.themeSource="dark",LoadingScreen.show()})),app.on("window-all-closed",(()=>{"darwin"!==process.platform&&app.quit()})),ipcMain.handle("get-package-info",(()=>Config.getPackageInfo)),ipcMain.handle("get-package-version",(()=>app.getVersion())),ipcMain.handle("versions",(()=>({dizipal:app.getVersion(),sistem:process.platform,node:process.versions.node,chrome:process.versions.chrome,electron:process.versions.electron}))),ipcMain.handle("get-dizipal",(()=>Config.getInformation)),ipcMain.handle("get-api-url",(async()=>await Api.getCurrentSiteURL())),ipcMain.handle("get-loaded-url",(()=>MainScreen.window.webContents.getURL())),ipcMain.on("loading-is-done",((e,n)=>{setLoadingIsDone(n)})),ipcMain.on("set-dizipal",((e,n)=>{Config.setInformation(n)})),ipcMain.on("notification",((e,n)=>{Alert.show_notification(n)})),ipcMain.on("restart-app",(()=>{app.relaunch(),app.exit(0)})),ipcMain.on("close-menu",((e,n)=>{const i=Menus.close();i.hasOwnProperty(n)?i[n]():console.error(`Menü "${n}" bulunamadı.`)})),ipcMain.on("reload-url",((e,n,i)=>{MainScreen.reload(n,i)})),ipcMain.on("connection",((e,n)=>{n?(app.relaunch(),app.exit(0)):MainScreen.window&&!MainScreen.window.isDestroyed()?MainScreen.window.loadFile(path.join(__dirname,"pages","no-connection","index.html")).then((()=>{console.log("✓ Yönlendirme: no-connection sayfasına başarıyla geçildi.")})).catch((e=>{console.error("✗ Yönlendirme hatası:",e)})):console.error("✗ MainScreen.window nesnesi yok veya henüz hazır değil.")}));